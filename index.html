async function filterRecordsByFio(patient_FIO) {
  try {
    // Получаем все записи из таблицы
    const tableData = await grist.fetchSelectedTable();
    console.log("Данные таблицы:", tableData); // Отладка

    // Очищаем таблицу перед добавлением новых данных
    const tableBody = document.querySelector('#doctorsTable tbody');
    tableBody.innerHTML = '';

    // Группируем данные по участникам
    const groupedData = groupDataByParticipant(tableData, patient_FIO);

    // Собираем все уникальные значения МКФ
    const mkfValues = new Set();

    // Добавляем отфильтрованные записи в таблицу
    let rowNumber = 1;
    groupedData.forEach(participant => {
      // Добавляем строку с участником
      const participantRow = tableBody.insertRow();
      participantRow.classList.add('participant-row');
      participantRow.insertCell().textContent = rowNumber++;
      participantRow.insertCell().textContent = participant.name || '';
      participantRow.insertCell().textContent = participant.uchastie || '';
      participantRow.insertCell().textContent = ''; // Цель (пусто, так как это подстрока)
      participantRow.insertCell().textContent = ''; // МКФ (пусто, так как это подстрока)
      participantRow.insertCell().textContent = ''; // Задачи (пусто, так как это подстрока)
      participantRow.insertCell().textContent = ''; // Методика (пусто, так как это подстрока)
      participantRow.insertCell().textContent = ''; // Оценка до курса (пусто, так как это подстрока)
      participantRow.insertCell().textContent = ''; // Оценка после курса (пусто, так как это подстрока)

      // Добавляем строки с целями, задачами и методиками
      participant.goals.forEach(goal => {
        const goalRow = tableBody.insertRow();
        goalRow.classList.add('goal-row');
        goalRow.insertCell().textContent = ''; // № (пусто, так как это подстрока)
        goalRow.insertCell().textContent = ''; // Участник (пусто, так как это подстрока)
        goalRow.insertCell().textContent = ''; // Участие (пусто, так как это подстрока)
        goalRow.insertCell().textContent = goal.target || ''; // Цель
        goalRow.insertCell().textContent = ''; // МКФ (пусто, так как это подстрока)
        goalRow.insertCell().textContent = ''; // Задачи (пусто, так как это подстрока)
        goalRow.insertCell().textContent = ''; // Методика (пусто, так как это подстрока)
        goalRow.insertCell().textContent = ''; // Оценка до курса (пусто, так как это подстрока)
        goalRow.insertCell().textContent = ''; // Оценка после курса (пусто, так как это подстрока)

        goal.tasks.forEach(task => {
          const taskRow = tableBody.insertRow();
          taskRow.classList.add('task-row');
          taskRow.insertCell().textContent = ''; // № (пусто, так как это подстрока)
          taskRow.insertCell().textContent = ''; // Участник (пусто, так как это подстрока)
          taskRow.insertCell().textContent = ''; // Участие (пусто, так как это подстрока)
          taskRow.insertCell().textContent = ''; // Цель (пусто, так как это подстрока)
          taskRow.insertCell().textContent = task.Domen_C || ''; // МКФ
          taskRow.insertCell().textContent = task.zadachi || ''; // Задачи
          taskRow.insertCell().textContent = task.metodika || ''; // Методика
          taskRow.insertCell().textContent = task.ocenka_do_kursa || ''; // Оценка до курса
          taskRow.insertCell().textContent = task.ocenka_posle || ''; // Оценка после курса

          // Добавляем значение МКФ в Set
          if (task.Domen_C) {
            mkfValues.add(task.Domen_C);
          }
        });
      });
    });

    // Обновляем элемент с перечислением всех значений МКФ
    document.getElementById('mkf_values').textContent = Array.from(mkfValues).join(', ');
  } catch (error) {
    console.error("Ошибка при фильтрации записей:", error); // Отладка
  }
}
